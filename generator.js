#!/usr/bin/env node
var $=Object.create;var u=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var N=(e,s,a,r)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of h(s))!E.call(e,t)&&t!==a&&u(e,t,{get:()=>s[t],enumerable:!(r=g(s,t))||r.enumerable});return e};var c=(e,s,a)=>(a=e!=null?$(S(e)):{},N(s||!e||!e.__esModule?u(a,"default",{value:e,enumerable:!0}):a,e));var p=c(require("path")),o=c(require("fs-extra")),y=c(require("knex"));process.stdout.write(process.platform==="win32"?"\x1B[2J\x1B[0f":"\x1B[2J\x1B[3J\x1B[H");function C(e){switch(e.split("(")[0]){case"date":case"datetime":case"timestamp":case"time":case"year":case"char":case"varchar":case"tinytext":case"text":case"mediumtext":case"longtext":case"json":case"decimal":return"Type.String()";case"tinyint":case"smallint":case"mediumint":case"int":case"bigint":case"float":case"double":return"Type.Number()";case"enum":const a=e.replace("enum(","").replace(")","").replaceAll(",",", ");return`Type.Unsafe<${a.replaceAll(", "," | ")}>({ type: 'string', enum: [${a}] })`}}const i=o.default.readJSONSync(p.default.join(process.cwd(),"mysql-typebox.json"));i.folder&&i.folder!==""&&o.default.emptyDirSync(i.folder);async function j(e){const s=(0,y.default)({client:"mysql2",connection:{host:e.host,port:e.port,user:e.user,password:e.password,database:e.database}});let r=(await s.raw("SELECT table_name FROM information_schema.tables WHERE table_schema = ?",[e.database]))[0].map(t=>t.table_name).filter(t=>!t.startsWith("knex_")).sort();e.tables&&e.tables.length&&(r=r.filter(t=>e.tables.includes(t))),e.ignore&&e.ignore.length&&(r=r.filter(t=>!e.ignore.includes(t)));for(const t of r){const f=(await s.raw(`DESC ${t}`))[0];let n=`import { Type } from '@sinclair/typebox'

export const ${t} = Type.Object({`;for(const l of f){const T=l.Field,m=C(l.Type),w=l.Null==="YES";n=`${n}
  ${T}: ${w?`Type.Optional(Type.Union([${m}, Type.Null()]))`:`${m}`},`}n=`${n}
})
`;const b=e.folder&&e.folder!==""?e.folder:".",x=e.suffix&&e.suffix!==""?`${t}.${e.suffix}.ts`:`${t}.ts`,d=p.default.join(b,x);console.log("Created:",d),o.default.outputFileSync(d,n)}await s.destroy()}(async()=>await j(i))();
